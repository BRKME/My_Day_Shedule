name: Daily Schedule Notifier
on:
  schedule:
    - cron: '0 3 * * *'   # 07:00 MSK ‚Äî —É—Ç—Ä–µ–Ω–Ω–µ–µ
    - cron: '0 16 * * *'   # 19:00 MSK ‚Äî –≤–µ—á–µ—Ä–Ω–µ–µ
  workflow_dispatch:
    inputs:
      period:
        description: '–ü–µ—Ä–∏–æ–¥'
        required: true
        default: 'morning'
        type: choice
        options:
          - morning
          - evening

jobs:
  send-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install aiohttp requests
      
      - name: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–û)
        id: period
        run: |
          if [[ "${{ github.event_name }}" == "schedule" ]]; then
            HOUR=$(date -u +%H)
            echo "–¢–µ–∫—É—â–∏–π —á–∞—Å UTC: $HOUR"
            
            # –£—Ç—Ä–æ: 04:00-10:00 UTC (07:00-13:00 MSK)
            if [[ "$HOUR" -ge 4 && "$HOUR" -lt 10 ]]; then
              echo "period=morning" >> $GITHUB_OUTPUT
              echo "‚úÖ –û–ø—Ä–µ–¥–µ–ª—ë–Ω –ø–µ—Ä–∏–æ–¥: MORNING"
            # –í–µ—á–µ—Ä: 16:00-22:00 UTC (19:00-01:00 MSK)
            elif [[ "$HOUR" -ge 16 && "$HOUR" -lt 22 ]]; then
              echo "period=evening" >> $GITHUB_OUTPUT
              echo "‚úÖ –û–ø—Ä–µ–¥–µ–ª—ë–Ω –ø–µ—Ä–∏–æ–¥: EVENING"
            else
              # Fallback –Ω–∞ –≤–µ—á–µ—Ä (–Ω–µ –¥–æ–ª–∂–Ω–æ —Å–ª—É—á–∏—Ç—å—Å—è)
              echo "period=evening" >> $GITHUB_OUTPUT
              echo "‚ö†Ô∏è –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —á–∞—Å: $HOUR, –∏—Å–ø–æ–ª—å–∑—É–µ–º EVENING"
            fi
          else
            echo "period=${{ inputs.period }}" >> $GITHUB_OUTPUT
            echo "‚úÖ –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫: ${{ inputs.period }}"
          fi
      
      - name: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ notifier.py —Å –ø–µ—Ä–∏–æ–¥–æ–º: ${{ steps.period.outputs.period }}"
          python notifier.py ${{ steps.period.outputs.period }}
